{"Name":"Select Random Analyst","Description":"","Script":"from SiemplifyAction import SiemplifyAction\nfrom SiemplifyUtils import unix_now, convert_unixtime_to_datetime, output_handler\nfrom ScriptResult import EXECUTION_STATE_COMPLETED, EXECUTION_STATE_FAILED,EXECUTION_STATE_TIMEDOUT\nimport random\nimport json\nimport time\n\nsiemplify = SiemplifyAction()\nIGNORE_TIME = siemplify.extract_action_param(\"Ignore time buffer?\", print_value=True)\n\n@output_handler\ndef main():\n\n    alert_ts = siemplify.current_alert.creation_time\n    epoch_time = int(time.time() * 1000)\n    # 10 mins is 600,000 ms\n    if epoch_time - alert_ts > 600000 and IGNORE_TIME == \"false\":\n        status = EXECUTION_STATE_COMPLETED\n        output_message = \"Skipping assignment as alert is > 10 minutes old.\"\n        result_value = \"Skipping assignment as alert is > 10 minutes old.\"\n\n        siemplify.LOGGER.info(\"\\n  status: {}\\n  result_value: {}\\n  output_message: {}\".format(status,result_value, output_message))\n        siemplify.end(output_message, result_value, status)\n\n\n    address = f\"{siemplify.API_ROOT}/{'external/v1/settings/GetUserProfiles'}\"\n    p = {\n        \"requestedPage\": 0,\n        \"pageSize\": 10000,\n        \"searchTerm\": \"\",\n        \"filterDisabledUsers\": True,\n        \"filterRole\": False,\n        \"filterPermissionTypes\": [],\n        \"filterSupportUsers\": True,\n        \"fetchOnlySupportUsers\": False\n    }\n    response = siemplify.session.post(url=address, json=p)\n    js = response.json()\n\n    # Get a random user from the list of users from the API\n    random_user = random.choice(js['objectsList'])\n    siemplify.LOGGER.info(\"Chose user \" + random_user['loginIdentifier'] + \" with GUID \" + random_user['userName'])\n\n    # Assign the case\n    case_id = siemplify.case_id\n    siemplify.LOGGER.info(\"Case ID is: \" + siemplify.case_id)\n    address = f\"{siemplify.API_ROOT}/{'external/v1/dynamic-cases/AssignUserToCase?format=camel'}\"\n    p = {\n        \"caseId\": case_id,\n        \"userId\": random_user['userName']\n    }\n    response = siemplify.session.post(url=address, json=p)\n\n    msg = \"Succesfully assigned case to: \" + random_user['loginIdentifier']\n    status = EXECUTION_STATE_COMPLETED\n    output_message = msg\n    result_value = msg\n\n    siemplify.LOGGER.info(\"\\n  status: {}\\n  result_value: {}\\n  output_message: {}\".format(status,result_value, output_message))\n    siemplify.end(output_message, result_value, status)\n\n\nif __name__ == \"__main__\":\n    main()\n","IntegrationIdentifier":"Custom Case Routing","ScriptResultName":"ScriptResult","DynamicResultsMetadata":[{"ResultName":"JsonResult","ResultExample":"{}","ShowResult":false}],"Creator":"036fe879-4c16-461e-b6d9-b1c552806fa0","IsEnabled":false,"IsCustom":true,"IsSystem":false,"Version":9.0,"TimeoutSeconds":600,"IsAsync":false,"AsyncPollingIntervalInSeconds":3600,"TotalIntervalTimeoutForAsyncInSeconds":86400,"Parameters":[{"CustomActionId":0,"IsMandatory":false,"DefaultValue":"false","Description":"This action will only assign a case if it's run within 10 minutes of the alert. This is  to suppress reassignment for multiple playbook runs","Name":"Ignore time buffer?","Value":"false","Type":1,"OptionalValues":null,"OptionalValuesJson":null}],"DefaultResultValue":"","PythonVersion":"None","SimulationData":{"Entities":null},"SimulationDataJson":null}